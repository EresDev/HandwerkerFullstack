dist: Xenial
language:
  - php
sudo: required
php:
  - 7.4
addons:
#  chrome: stable
  apt:
    packages:
      - nginx
      - realpath
  hosts:
    - hwfs.local
#cache:
#  yarn: true
#  directories:
#    - vendor
#    - "$HOME/.composer/cache/files"
#    - node_modules
env:
  global:
    - SYMFONY_VERSION="4.3.*" DB=mysql
    - SITE_URL="http://hwfs.local"
    - SITE_DOMAIN="hwfs.local"

before_install:
  - google-chrome-stable --headless --disable-gpu --remote-debugging-port=9222 http://localhost &
  - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.22.4
  - export PATH="$HOME/.yarn/bin:$PATH"

services:
  - mysql
install:
  - cp .env.travis .env
  - build/install-nginx.sh
  - composer install
  - npm install
  - yarn encore dev
  - php bin/console doctrine:database:create --env=test
  - php bin/console doctrine:schema:create --env=test
  - mkdir -p config/jwt
  - openssl genpkey -out config/jwt/private.pem -aes256 -algorithm rsa -pkeyopt rsa_keygen_bits:4096 -pass pass:7834rhgi8uhgfuw834hr879329hr
  - openssl pkey -in config/jwt/private.pem -out config/jwt/public.pem -pubout -passin pass:7834rhgi8uhgfuw834hr879329hr

script:
#  - curl -vsf 'http://hwfs.local:8080' &> /dev/stdout
#  - cat /tmp/error.log
  - php bin/phpunit tests/End2End/Infrastructure/Controller/RegisterUserControllerFrontendTest.php --verbose